<!DOCTYPE html>
<html>
    <head>
        <link href="https://fonts.googleapis.com/css?family=Lato|Montserrat|Roboto&display=swap" rel="stylesheet"> 
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <link rel="stylesheet" href="main.css">
        <title>GHSB</title>
    </head>
    <body>
        <h1>VENÇA E PODERÁ PROSSEGUIR</h1>
        <div class = "tabuleiro">
            <nav>
                <ul>
                    <li><button id = "20" onclick="u_joga('20')"></button></li>
                    <li><button id = "21" onclick="u_joga('21')"></button></li>
                    <li><button id = "22" onclick="u_joga('22')"></button></li>
                </ul>
                <ul>
                    <li><button id = "10" onclick="u_joga('10')"></button></li>
                    <li><button id = "11" onclick="u_joga('11')"></button></li>
                    <li><button id = "12" onclick="u_joga('12')"></button></li>
                </ul>
                <ul>
                    <li><button id = "00" onclick="u_joga('00')"></button></li>
                    <li><button id = "01" onclick="u_joga('01')"></button></li>
                    <li><button id = "02" onclick="u_joga('02')"></button></li>
                </ul>
            </nav>
        </div>
        <script>
            class jg{
                constructor()
                {
                    this._tab = [[0,0,0],[0,0,0],[0,0,0]];
                }

                get tab()
                {
                    return this._tab;
                }

                set tab(tab)
                {
                    this._tab = tab;
                }
            }
            

            class controle
            {
                //verifica se ja tem alguma peca
                disponivel(lin, col)
                {
                    let tabu = { new: jogo.tab };
                    if(tabu.new[lin][col] == 0)
                    {
                        return true;
                    } 
                    else
                    {
                        return false;
                    }
                }

                veri_lincol(tab, ind, lc)
                {
                    let j, i;
                    if(lc == 0)
                    {
                        j = 0;
                        i = ind;
                    }
                    else
                    {
                        j = ind;
                        i = 0;
                    }
                    let aux = {
                        res: true,
                        ant: tab[ind][ind]
                    }
                    while((i <= 2) && (j <= 2) && aux.res)
                    {
                        if(tab[i][j] != aux.ant)
                        {
                            aux.res = false;
                        }
                        else
                        {
                            aux.ant = tab[i][j]
                            if(lc == 0)
                            {
                                j++;
                            }
                            else
                            {
                                i++;
                            }
                        }
                    }

                    return aux.res;

                }

                //verifica apenas se o usuario ganhou ou perdeu
                verifica_fim()
                {
                    let tabu = jogo.tab;
                    let res = {
                        qual : 0,
                        ganhador: false
                    };
                    let i = 0;
                    //verifica linhas e colunas
                    while((res.ganhador == false) && (i <= 2))
                    {
                        if(tabu[i][i] !== 0)
                        {
                            //0- linha  1- coluna
                            res.ganhador = ctrl.veri_lincol(tabu, i, 0) ||
                                            ctrl.veri_lincol(tabu, i, 1);
                            res.qual = tabu[i][i];
                        }
                        i++;
                    }
                    
                    if(res.ganhador)
                    {
                        ctrl.ganha(i, )
                        return res.qual;
                    }
                    //verifica diagonal se ninguem ganhou
                    else
                    {
                        if(tabu[1][1] != 0)
                        {
                            if((tabu[0][0] == tabu[1][1]) && (tabu[2][2] == tabu[1][1])){
                                return tabu[1][1];
                            }
                            else{
                                if((tabu[0][2] == tabu[1][1]) && (tabu[2][0] == tabu[1][1])){
                                    return tabu[1][1];
                                }
                                else{
                                    return 0;
                                }
                            }
                        }
                        else{
                        return 0;
                        }
                    }

                }

                //verifica se deu velha
                verifica_velha()
                {
                    let tabu = jogo.tab; 
                    let veri = 0;
                    for(let i = 0; i < 2; i++)
                    {
                        for(let j = 0; j < 2; j++)
                        {
                            if(tabu[i][j] !== 0)
                            {
                                veri++;
                            }

                        }
                    }

                    if(veri == 9)
                    {
                        return false;
                    }
                    else
                    {
                        return true;
                    }
                }
            }

            class usuario
            {
                joga(pos)
                {
                    //coloca no botao
                    document.getElementById(pos).innerHTML = "X";
                    document.getElementById(pos).disable = true; 

                    //converte e pega a posicao
                    let z = parseInt(pos, 10);
                    let lin = Math.trunc(z/10);
                    let col = z % 10;
 
                    let tabu = { new: jogo.tab } 
                    tabu.new[lin][col] = 1;
                    jogo.tab = tabu.new;
                }
            }

            class pc
            { 
                joga()
                {
                    let tabu = { new: jogo.tab };
                    let pos = {
                        lin : 0,
                        col : 0
                    }; 
                    //"inteligencia"
                    //acha um lugar livre aleatoriamente
                    while(tabu.new[pos.lin][pos.col] !== 0)
                    {
                        pos.lin = Math.floor(Math.random() * (2 - 0 + 1)) + 0;
                        pos.col = Math.floor(Math.random() * (2 - 0 + 1)) + 0;
                    }
                    //joga
                    tabu.new[pos.lin][pos.col] = 2;
                    jogo.tab = tabu.new; 

                    //configura no tabuleiro
                    pos.lin = pos.lin * 10;
                    pos.lin = pos.lin + pos.col;
                    let pos_str = pos.lin.toString();
                    if(pos_str.length == 1){
                        let zero = '0';
                        document.getElementById(zero.concat(pos_str)).innerHTML = "O";
                        document.getElementById(zero.concat(pos_str)).disable = true; 
                    }
                    else{
                        document.getElementById(pos_str).innerHTML = "O";
                        document.getElementById(pos_str).disable = true;
                    } 
                }

            }

            let u = new usuario;
            let p = new pc;
            let ctrl = new controle;
            let jogo = new jg();

            let resul = {
                fim : false,
                ganhador: 0
            }
            function u_joga (pos)
            {
                if (res.fim == false)
                {
                    //chama o metodo do usuario
                    u.joga(pos);
                    //verifica fim do jogo
                    res.ganhador = ctrl.verifica_fim();
                    res.fim = !((res.ganhador == 0)&& ctrl.verifica_velha());

                    if(res.fim == false)
                    {
                        //pc joga
                        p.joga();
                        //verifica fim do jogo
                        res.ganhador = ctrl.verifica_fim();
                    }
                    
                }
                else
                {

                }
                
            }

        </script>
    </body>
</html>